<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
   "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" []>

<section id="container.mobicents-sip-servlets-embedded-1.x">

	<title>Mobicents Sip Servlets 1.x - Embedded</title>

	<para id="container.mobicents-sip-servlets-embedded-1.x.description">
      A DeployableContainer implementation that manages the complete lifecycle
      of an embedded (same JVM) Mobicents Sip Servlets 1.x SIP Servlets Container. (Keep in mind that
      only select EE APIs are available in Mobicents Sip Servlets 1.x, such as JNDI, SIP Servlets 1.1 and Servlet
      2.5). Test archives are adapted to Mobicents Sip Servlets's SipStandardContext API by
      ShrinkWrap and deployed programmatically.
	</para>

	<table id="container.mobicents-sip-servlets-embedded-1.x.injection" frame="all">
		<title>Container Injection Support Matrix</title>
		<tgroup cols="6">
			<colspec colnum="1" colname="resource" colwidth="1*" />
			<colspec colnum="2" colname="ejb" colwidth="1*" />
			<colspec colnum="3" colname="ejb_local" colwidth="2*" />
			<!--colspec colnum="4" colname="inject_cdi" colwidth="2*" />
			<colspec colnum="5" colname="inject_mc" colwidth="2*" /-->
			<colspec colnum="4" colname="persistence" colwidth="3*" />
			<thead>
				<row>
					<entry>@Resource</entry>
					<entry>@EJB</entry>
					<entry>@EJB (no-interface)</entry>
					<!--entry>@Inject (CDI)</entry>
					<entry>@Inject (MC)</entry-->
					<entry>@PersistenceContext @PersistenceUnit</entry>
				</row>
			</thead>
			<tbody>
				<row>
					<entry>
						<mediaobject>
							<imageobject>
								<imagedata fileref="images/fact_good.png" format="PNG"
									align="center" scalefit="0" />
							</imageobject>
						</mediaobject>
					</entry>
					<entry></entry>
					<entry></entry>
					<entry>
						<mediaobject>
							<imageobject>
								<imagedata fileref="images/fact_good.png" format="PNG"
									align="center" scalefit="0" />
							</imageobject>
						</mediaobject>
               </entry>
					<entry></entry>
					<entry></entry>
				</row>
			</tbody>
		</tgroup>
	</table>
	
	<!--warning>
     CDI support requires use of Weld Servlet and associated configuration. The WAR will
     have to be unpacked as well (the default) in order for Weld to locate the classes.
	</warning>

	<para>
     Running an in-container test on Mobicents Sip Servlets 1;x currently requires that you add
     the Arquillian Protocol Servlet to the test archive's web.xml, a temporary
     measure until <ulink src="http://jira.jboss.org/browse/ARQ-217">ARQ-217</ulink> is resolved. The listing
     below shows a minimum web.xml containing the required Servlet mapping:
   </para>
   
   <programlisting role="XML"><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.5"
   xmlns="http://java.sun.com/xml/ns/javaee"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="
      http://java.sun.com/xml/ns/javaee
      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">

   <servlet>
      <servlet-name>ServletTestRunner</servlet-name>
      <servlet-class>org.jboss.arquillian.protocol.servlet_3.ServletTestRunner</servlet-class>
   </servlet>

   <servlet-mapping>
      <servlet-name>ServletTestRunner</servlet-name>
      <url-pattern>/ArquillianServletRunner</url-pattern>
   </servlet-mapping>

</web-app>]]></programlisting>

   <para>
      If you forget to add this Servlet mapping for a test using the
      in-container run mode, you will get a failure with the message "Kept
      getting 404s" because Arquillian can't communicate with the deployed
      application.
   </para-->

	<section id="container.mobicents-sip-servlets-embedded-1.x.configuration">
		<title>Configuration</title>

		<para>
			Namespace: urn:arq:org.jboss.arquillian.container.mobicents.servlet.sip.embedded_1x
		</para>
		<table frame="all">
			<title>Container Configuration Options</title>
			<tgroup cols="4">
				<colspec colnum="1" colname="name" colwidth="2*" />
				<colspec colnum="2" colname="type" colwidth="1*" />
				<colspec colnum="3" colname="default" colwidth="3*" />
				<colspec colnum="4" colname="description" colwidth="4*" />
				<thead>
					<row>
						<entry>Name</entry>
						<entry>Type</entry>
						<entry>Default</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>bindHttpPort</entry>
						<entry>int</entry>
						<entry>9090</entry>
						<entry>The HTTP port the server should bind to.</entry>
					</row>
					<row>
						<entry>bindAddress</entry>
						<entry>String</entry>
						<entry>localhost</entry>
						<entry>The host the server should be run on.</entry>
					</row>
					<row>
						<entry>sipConnectors</entry>
						<entry>String</entry>
						<entry>:5080</entry>
						<entry>A comma separated list of values &lt;ip_address&gt;:&lt;sip_port&gt;/&lt;transport&gt; for SIP Connectors. The ip address value is optional, if it is not specified the bindAddress specified above is assumed. The transport value is optional, if not specified UDP is assumed.</entry>
					</row>
					<row>
						<entry>tomcatHome</entry>
						<entry>String</entry>
						<entry></entry>
						<entry>Optional location of a Mobicents Sip Servlets' Tomcat installation to link against.</entry>
					</row>
					<row>
						<entry>serverName</entry>
						<entry>String</entry>
						<entry></entry>
						<entry>Optional name of the server</entry>
					</row>
					<row>
						<entry>appBase</entry>
						<entry>String</entry>
						<entry></entry>
						<entry>Optional relative or absolute path to the directory where applications are deployed (e.g., webapps).</entry>
					</row>
					<row>
						<entry>workDir</entry>
						<entry>String</entry>
						<entry></entry>
						<entry>Optional relative or absolute path to the directory where applications are expanded and session serialization data is stored (e.g., work).</entry>
					</row>
					<row>
						<entry>sipApplicationRouterProviderClassName</entry>
						<entry>String</entry>
						<entry>org.mobicents.servlet.sip.router.DefaultApplicationRouterProvider</entry>
						<entry>The full class name of the Application Router Provider class that the Mobicents Sip Servlets container should use to route SIP Messages to applications</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>

	<para>Example of Maven profile setup</para>

	<programlisting role="XML"><![CDATA[<profile>
	<id>mobicents-sip-servlets-embedded</id>
	<dependencies>
		<dependency>
			<groupId>org.jboss.arquillian.container</groupId>
			<artifactId>arquillian-mobicents-sip-servlets-embedded-1.x</artifactId>
			<version>1.0.0-SNAPSHOT</version>
                        <scope>test</scope>
		</dependency>
      <dependency>
         <groupId>org.apache.tomcat</groupId>
         <artifactId>catalina</artifactId>
         <version>6.0.29</version>
         <scope>test</scope>
      </dependency>
      <dependency>
         <groupId>org.apache.tomcat</groupId>
         <artifactId>coyote</artifactId>
         <version>6.0.29</version>
         <scope>provided</scope>
      </dependency>
      <dependency>
         <groupId>org.apache.tomcat</groupId>
         <artifactId>jasper</artifactId>
         <version>6.0.29</version>
         <scope>provided</scope>
      </dependency>
      <dependency>
         <groupId>org.mobicents.servlet.sip</groupId>
         <artifactId>sip-servlets-impl</artifactId>
         <version>1.3.2</version>
         <scope>provided</scope>
      </dependency>
      
      <dependency>
         <groupId>org.mobicents.servlet.sip</groupId>
         <artifactId>sip-servlets-tomcat-jboss4</artifactId>
         <version>1.3.2</version>
         <scope>provided</scope>
      </dependency>

      <dependency>
         <groupId>javax.servlet.jsp</groupId>
         <artifactId>jsp-api</artifactId>
         <version>2.2</version>
         <scope>test</scope>
      </dependency>
<!-- Mobicents Sip Servlets libs required for testing -->
	  
	   <dependency>
			<groupId>javax.sip</groupId>
			<artifactId>jain-sip-api</artifactId>
			<version>1.2</version>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>javax.sip</groupId>
			<artifactId>jain-sip-ri</artifactId>
			<version>1.2.153</version>
			<scope>test</scope>
		</dependency>
		
		<dependency>
	      <groupId>log4j</groupId>
	      <artifactId>log4j</artifactId>
	      <version>1.2.14</version>
	      <scope>test</scope>
	    </dependency>
	    
	    <dependency>
			<groupId>org.mobicents.tools</groupId>
			<artifactId>sip-balancer-jar</artifactId>
			<version>1.0.1</version>
			<scope>test</scope>
		</dependency>
		
		<dependency>			
			<groupId>org.mobicents.ha.javax.sip</groupId>
			<artifactId>mobicents-jain-sip-ha-core</artifactId>
			<version>0.11</version>
			<scope>test</scope>				
		</dependency>
		
		<dependency>			
			<groupId>org.mobicents.ha.javax.sip</groupId>
			<artifactId>mobicents-jain-sip-jboss4</artifactId>
			<version>0.11</version>
			<scope>test</scope>				
		</dependency>
		
		<dependency>
			<groupId>javax.activation</groupId>
			<artifactId>activation</artifactId>
			<version>1.1.1</version>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>javax.mail</groupId>
			<artifactId>mail</artifactId>
			<version>1.4</version>
			<scope>test</scope>
		</dependency>
		
		<dependency>
			<groupId>org.dnsjava</groupId>
			<artifactId>dnsjava</artifactId>
			<version>2.0.6</version>
			<scope>test</scope>
		</dependency>
		
		<dependency>
         	<groupId>org.jboss.shrinkwrap.sip</groupId>
         	<artifactId>shrinkwrap-extension-sip-impl</artifactId>
         	<scope>test</scope>
         	<version>1.0.0-SNAPSHOT</version>
      	</dependency>
	</dependencies>
</profile>]]></programlisting>
</section>
